<!-- HTML header for doxygen 1.8.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>oneDNN: Layer Normalization</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script src="assets/mathjax/MathJax.js?config=TeX-AMS_CHTML,dnnl"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="assets/customdoxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="assets/dnn.js"></script>
</head>
<body>
<div class="mobile-nav"><i id="nav-btn"></i><a href="index.html">oneAPI Deep Neural Network Library (oneDNN)</a></div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
   <div id="projectname">
     <a href="index.html">
      <div id="full-name">oneAPI Deep Neural Network Library (oneDNN)</div>
    </a>
   </div>
   <div id="projectbrief">Performance library for Deep Learning</div>
   <div id="projectnumber">2.1.3</div>
  <div>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('dev_guide_layer_normalization.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Layer Normalization </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><blockquote class="doxtable">
<p></p>
<p><a class="el" href="group__dnnl__api__layer__normalization.html">API Reference</a></p>
<p></p>
</blockquote>
<h2>General</h2>
<p>The layer normalization primitive performs a forward or backward layer normalization operation on a 2-5D data tensor.</p>
<h3>Forward</h3>
<p>The layer normalization operation performs normalization over the last logical axis of the data tensor and is defined by the following formulas. We show formulas only for 3D data, which are straightforward to generalize to cases of higher dimensions. Variable names follow the standard <a class="el" href="dev_guide_conventions.html">Naming Conventions</a>.</p>
<p class="formulaDsp">
\[ \dst(t, n, c) = \gamma(c) \cdot \frac{\src(t, n, c) - \mu(t, n)} {\sqrt{\sigma^2(t, n) + \varepsilon}} + \beta(c), \]
</p>
<p>where</p>
<ul>
<li>\(\gamma(c), \beta(c)\) are optional scale and shift for a channel (see <a class="el" href="group__dnnl__api__primitives__common.html#gga301f673522a400c7c1e75f518431c9a3aeba5189d91e23448d706fb027867ae55" title="Use scale and shift parameters. ">dnnl_use_scaleshift</a> flag),</li>
<li>\(\mu(t, n), \sigma^2(t, n)\) are mean and variance (see <a class="el" href="group__dnnl__api__primitives__common.html#gga301f673522a400c7c1e75f518431c9a3aec04425c28af752c0f8b4dc5ae11fb19" title="Use global statistics. ">dnnl_use_global_stats</a> flag), and</li>
<li>\(\varepsilon\) is a constant to improve numerical stability.</li>
</ul>
<p>Mean and variance are computed at runtime or provided by a user. When mean and variance are computed at runtime, the following formulas are used:</p>
<ul>
<li>\(\mu(t, n) = \frac{1}{C} \sum\limits_{c} \src(t, n, c)_{}\),</li>
<li>\(\sigma^2(t, n) = \frac{1}{C} \sum\limits_{c} {}_{} (\src(t, n, c) - \mu(t, n))^2\).</li>
</ul>
<p>The \(\gamma(c)\) and \(\beta(c)\) tensors are considered learnable.</p>
<h4>Difference Between Forward Training and Forward Inference</h4>
<ul>
<li>If mean and variance are computed at runtime (i.e., <a class="el" href="group__dnnl__api__primitives__common.html#gga301f673522a400c7c1e75f518431c9a3aec04425c28af752c0f8b4dc5ae11fb19" title="Use global statistics. ">dnnl_use_global_stats</a> is not set), they become outputs for the propagation kind <a class="el" href="group__dnnl__api__primitives__common.html#ggae3c1f22ae55645782923fbfd8b07d0c4a992e03bebfe623ac876b3636333bbce0" title="Forward data propagation (training mode). ">dnnl_forward_training</a> (because they would be required during the backward propagation). Data layout for mean and variance must be specified during initialization of the layer normalization descriptor by passing the memory descriptor for statistics (e.g., by passing stat_desc in <a class="el" href="structdnnl_1_1layer__normalization__forward_1_1desc.html#a4a7cdc2f605d5be0ab33d5ec2d8a7339" title="Constructs a descriptor for layer normalization forward propagation primitive. ">dnnl::layer_normalization_forward::desc::desc()</a>). Mean and variance are not exposed for the propagation kind <a class="el" href="group__dnnl__api__primitives__common.html#ggae3c1f22ae55645782923fbfd8b07d0c4a2f77a568a675dec649eb0450c997856d" title="Forward data propagation (inference mode). ">dnnl_forward_inference</a>.</li>
</ul>
<h3>Backward</h3>
<p>The backward propagation computes \(\diffsrc(t, n, c)\), \(\diffgamma(c)^*\), and \(\diffbeta(c)^*\) based on \(\diffdst(t, n, c)\), \(src(t, n, c)\), \(\mu(t, n)\), \(\sigma^2(t, n)\), \(\gamma(c) ^*\), and \(\beta(c) ^*\).</p>
<p>The tensors marked with an asterisk are used only when the primitive is configured to use \(\gamma(c)\), and \(\beta(c)\) (i.e., <a class="el" href="group__dnnl__api__primitives__common.html#gga301f673522a400c7c1e75f518431c9a3aeba5189d91e23448d706fb027867ae55" title="Use scale and shift parameters. ">dnnl_use_scaleshift</a> is set).</p>
<h2>Execution Arguments</h2>
<p>Depending on the <a class="el" href="group__dnnl__api__primitives__common.html#ga301f673522a400c7c1e75f518431c9a3">flags</a> and <a class="el" href="group__dnnl__api__primitives__common.html#gae3c1f22ae55645782923fbfd8b07d0c4">propagation kind</a>, the layer normalization primitive requires different inputs and outputs. For clarity, a summary is shown below.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft"></th><th class="markdownTableHeadLeft"><a class="el" href="group__dnnl__api__primitives__common.html#ggae3c1f22ae55645782923fbfd8b07d0c4a2f77a568a675dec649eb0450c997856d" title="Forward data propagation (inference mode). ">dnnl_forward_inference</a>  </th><th class="markdownTableHeadLeft"><a class="el" href="group__dnnl__api__primitives__common.html#ggae3c1f22ae55645782923fbfd8b07d0c4a992e03bebfe623ac876b3636333bbce0" title="Forward data propagation (training mode). ">dnnl_forward_training</a>  </th><th class="markdownTableHeadLeft"><a class="el" href="group__dnnl__api__primitives__common.html#ggae3c1f22ae55645782923fbfd8b07d0c4a326a5e31769302972e7bded555e1cc10" title="Backward propagation (with respect to all parameters). ">dnnl_backward</a>  </th><th class="markdownTableHeadLeft"><a class="el" href="group__dnnl__api__primitives__common.html#ggae3c1f22ae55645782923fbfd8b07d0c4a524dd6cb2ed9680bbd170ba15261d218" title="Backward data propagation. ">dnnl_backward_data</a>   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a class="el" href="group__dnnl__api__primitives__common.html#gga301f673522a400c7c1e75f518431c9a3ab71f2077a94fd4bbc107a09b115a24a4" title="Use no normalization flags. ">dnnl_normalization_flags_none</a>  </td><td class="markdownTableBodyLeft"><em>Inputs</em>: \(\src\) <br />
<br />
 <em>Outputs</em>: \(\dst\)  </td><td class="markdownTableBodyLeft"><em>Inputs</em>: \(\src\) <br />
<br />
 <em>Outputs</em>: \(\dst\), \(\mu\), \(\sigma^2\)  </td><td class="markdownTableBodyLeft"><em>Inputs</em>: \(\diffdst\), \(\src\), \(\mu\), \(\sigma^2\) <br />
<br />
 <em>Outputs</em>: \(\diffsrc\)  </td><td class="markdownTableBodyLeft">Same as for <a class="el" href="group__dnnl__api__primitives__common.html#ggae3c1f22ae55645782923fbfd8b07d0c4a326a5e31769302972e7bded555e1cc10" title="Backward propagation (with respect to all parameters). ">dnnl_backward</a>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><a class="el" href="group__dnnl__api__primitives__common.html#gga301f673522a400c7c1e75f518431c9a3aec04425c28af752c0f8b4dc5ae11fb19" title="Use global statistics. ">dnnl_use_global_stats</a>  </td><td class="markdownTableBodyLeft"><em>Inputs</em>: \(\src\), \(\mu\), \(\sigma^2\) <br />
<br />
 <em>Outputs</em>: \(\dst\)  </td><td class="markdownTableBodyLeft"><em>Inputs</em>: \(\src\), \(\mu\), \(\sigma^2\) <br />
<br />
 <em>Outputs</em>: \(\dst\)  </td><td class="markdownTableBodyLeft"><em>Inputs</em>: \(\diffdst\), \(\src\), \(\mu\), \(\sigma^2\) <br />
<br />
 <em>Outputs</em>: \(\diffsrc\)  </td><td class="markdownTableBodyLeft">Same as for <a class="el" href="group__dnnl__api__primitives__common.html#ggae3c1f22ae55645782923fbfd8b07d0c4a326a5e31769302972e7bded555e1cc10" title="Backward propagation (with respect to all parameters). ">dnnl_backward</a>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a class="el" href="group__dnnl__api__primitives__common.html#gga301f673522a400c7c1e75f518431c9a3aeba5189d91e23448d706fb027867ae55" title="Use scale and shift parameters. ">dnnl_use_scaleshift</a>  </td><td class="markdownTableBodyLeft"><em>Inputs</em>: \(\src\), \(\gamma\), \(\beta\) <br />
<br />
 <em>Outputs</em>: \(\dst\)  </td><td class="markdownTableBodyLeft"><em>Inputs</em>: \(\src\), \(\gamma\), \(\beta\) <br />
<br />
 <em>Outputs</em>: \(\dst\), \(\mu\), \(\sigma^2\)  </td><td class="markdownTableBodyLeft"><em>Inputs</em>: \(\diffdst\), \(\src\), \(\mu\), \(\sigma^2\), \(\gamma\), \(\beta\) <br />
<br />
 <em>Outputs</em>: \(\diffsrc\), \(\diffgamma\), \(\diffbeta\)  </td><td class="markdownTableBodyLeft">Not supported   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><a class="el" href="group__dnnl__api__primitives__common.html#gga301f673522a400c7c1e75f518431c9a3aec04425c28af752c0f8b4dc5ae11fb19" title="Use global statistics. ">dnnl_use_global_stats</a> | <a class="el" href="group__dnnl__api__primitives__common.html#gga301f673522a400c7c1e75f518431c9a3aeba5189d91e23448d706fb027867ae55" title="Use scale and shift parameters. ">dnnl_use_scaleshift</a>  </td><td class="markdownTableBodyLeft"><em>Inputs</em>: \(\src\), \(\mu\), \(\sigma^2\), \(\gamma\), \(\beta\) <br />
<br />
 <em>Outputs</em>: \(\dst\)  </td><td class="markdownTableBodyLeft"><em>Inputs</em>: \(\src\), \(\mu\), \(\sigma^2\), \(\gamma\), \(\beta\) <br />
<br />
 <em>Outputs</em>: \(\dst\)  </td><td class="markdownTableBodyLeft"><em>Inputs</em>: \(\diffdst\), \(\src\), \(\mu\), \(\sigma^2\), \(\gamma\), \(\beta\) <br />
<br />
 <em>Outputs</em>: \(\diffsrc\), \(\diffgamma\), \(\diffbeta\)  </td><td class="markdownTableBodyLeft">Not supported   </td></tr>
</table>
<p>When executed, the inputs and outputs should be mapped to an execution argument index as specified by the following table.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Primitive input/output  </th><th class="markdownTableHeadNone">Execution argument index   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">\(\src\)  </td><td class="markdownTableBodyNone">DNNL_ARG_SRC   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">\(\gamma, \beta\)  </td><td class="markdownTableBodyNone">DNNL_ARG_SCALE_SHIFT   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">mean ( \(\mu\))  </td><td class="markdownTableBodyNone">DNNL_ARG_MEAN   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">variance ( \(\sigma\))  </td><td class="markdownTableBodyNone">DNNL_ARG_VARIANCE   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">\(\dst\)  </td><td class="markdownTableBodyNone">DNNL_ARG_DST   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">\(\diffdst\)  </td><td class="markdownTableBodyNone">DNNL_ARG_DIFF_DST   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">\(\diffsrc\)  </td><td class="markdownTableBodyNone">DNNL_ARG_DIFF_SRC   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">\(\diffgamma\), \(\diffbeta\)  </td><td class="markdownTableBodyNone">DNNL_ARG_DIFF_SCALE_SHIFT   </td></tr>
</table>
<h2>Implementation Details</h2>
<h3>General Notes</h3>
<ol type="1">
<li>The different flavors of the primitive are partially controlled by the <code>flags</code> parameter that is passed to the operation descriptor initialization function (e.g., <a class="el" href="structdnnl_1_1layer__normalization__forward_1_1desc.html#a4a7cdc2f605d5be0ab33d5ec2d8a7339" title="Constructs a descriptor for layer normalization forward propagation primitive. ">dnnl::layer_normalization_forward::desc::desc()</a>). Multiple flags can be set using the bitwise OR operator (<code>|</code>).</li>
<li>For forward propagation, the mean and variance might be either computed at runtime (in which case they are outputs of the primitive) or provided by a user (in which case they are inputs). In the latter case, a user must set the <a class="el" href="group__dnnl__api__primitives__common.html#gga301f673522a400c7c1e75f518431c9a3aec04425c28af752c0f8b4dc5ae11fb19" title="Use global statistics. ">dnnl_use_global_stats</a> flag. For the backward propagation, the mean and variance are always input parameters.</li>
<li>The memory format and data type for <code>src</code> and <code>dst</code> are assumed to be the same, and in the API they are typically referred to as <code>data</code> (e.g., see <code>data_desc</code> in <a class="el" href="structdnnl_1_1layer__normalization__forward_1_1desc.html#a4a7cdc2f605d5be0ab33d5ec2d8a7339" title="Constructs a descriptor for layer normalization forward propagation primitive. ">dnnl::layer_normalization_forward::desc::desc()</a>). The same is true for <code>diff_src</code> and <code>diff_dst</code>. The corresponding memory descriptors are referred to as <code>diff_data_desc</code>.</li>
<li>Both forward and backward propagation support in-place operations, meaning that \(\src\) can be used as input and output for forward propagation, and \(\diffdst\) can be used as input and output for backward propagation. In case of an in-place operation, the original data will be overwritten. Note, however, that backward propagation requires original \(\src\), hence the corresponding forward propagation should not be performed in-place.</li>
</ol>
<h3>Data Type Support</h3>
<p>The operation supports the following combinations of data types:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Propagation  </th><th class="markdownTableHeadLeft">Source / Destination  </th><th class="markdownTableHeadLeft">Mea   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">forward / backward  </td><td class="markdownTableBodyLeft">f32, bf16  </td><td class="markdownTableBodyLeft">f32   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">forward  </td><td class="markdownTableBodyLeft">f16  </td><td class="markdownTableBodyLeft">f32   </td></tr>
</table>
<h3>Data Representation</h3>
<h4>Mean and Variance</h4>
<p>The mean ( \(\mu\)) and variance ( \(\sigma^2\)) are separate tensors with number of dimensions equal to ( \(data\_ndims - 1\)) and size \((data\_dim[0], data\_dim[1], ..., data\_dim[ndims - 2])\).</p>
<p>The corresponding memory object can have an arbitrary memory format. Unless mean and variance are computed at runtime and not exposed (i.e., propagation kind is <a class="el" href="group__dnnl__api__primitives__common.html#ggae3c1f22ae55645782923fbfd8b07d0c4a2f77a568a675dec649eb0450c997856d" title="Forward data propagation (inference mode). ">dnnl_forward_inference</a> and <a class="el" href="group__dnnl__api__primitives__common.html#gga301f673522a400c7c1e75f518431c9a3aec04425c28af752c0f8b4dc5ae11fb19" title="Use global statistics. ">dnnl_use_global_stats</a> is not set), the user should provide a memory descriptor for statistics when initializing the layer normalization descriptor. For best performance, it is advised to use the memory format that follows the data memory format; i.e., if the data format is <a class="el" href="group__dnnl__api__memory.html#gga395e42b594683adb25ed2d842bb3091da2a9735ec024c9362b717304edbfe2237" title="3D RNN data tensor in the format (seq_length, batch, input channels), an alias to dnnl_abc...">dnnl_tnc</a>, the best performance can be expected for statistics with the <a class="el" href="group__dnnl__api__memory.html#gga395e42b594683adb25ed2d842bb3091dac1ee747f881fc8cae805ae4051e671cf" title="2D RNN statistics tensor, an alias to dnnl_ab ">dnnl_tn</a> format and suboptimal for statistics with the <a class="el" href="group__dnnl__api__memory.html#gga395e42b594683adb25ed2d842bb3091da7ede27a46172c1ab2775593ba4b118dc" title="2D RNN statistics tensor, an alias to dnnl_ba ">dnnl_nt</a> format.</p>
<h4>Scale and Shift</h4>
<p>If used, the scale ( \(\gamma\)) and shift ( \(\beta\)) are combined in a single 2D tensor of shape \(2 \times C\).</p>
<p>The format of the corresponding memory object must be <a class="el" href="group__dnnl__api__memory.html#gga395e42b594683adb25ed2d842bb3091dac08a541001fe70289305a5fbde48906d" title="2D CNN activations tensor, an alias to dnnl_ab ">dnnl_nc</a> (<a class="el" href="group__dnnl__api__memory.html#gga395e42b594683adb25ed2d842bb3091da1bd907fc29344dfe7ba88336960dcf53" title="plain 2D tensor ">dnnl_ab</a>).</p>
<h4>Source, Destination, and Their Gradients</h4>
<p>The layer normalization primitive works with an arbitrary data tensor; however, it was designed for RNN data tensors (i.e., <a class="el" href="group__dnnl__api__memory.html#gga395e42b594683adb25ed2d842bb3091dac08a541001fe70289305a5fbde48906d" title="2D CNN activations tensor, an alias to dnnl_ab ">dnnl_nc</a>, <a class="el" href="group__dnnl__api__memory.html#gga395e42b594683adb25ed2d842bb3091da2a9735ec024c9362b717304edbfe2237" title="3D RNN data tensor in the format (seq_length, batch, input channels), an alias to dnnl_abc...">dnnl_tnc</a>, <a class="el" href="group__dnnl__api__memory.html#gga395e42b594683adb25ed2d842bb3091da4fd1cf9fdb67c554bcd8281695b65b3c" title="4D RNN states tensor in the format (num_layers, num_directions, batch, state channels), an alias to dnnl_abcd. ">dnnl_ldnc</a>). Unlike CNN data tensors, RNN data tensors have a single feature dimension. Layer normalization performs normalization over the last logical dimension (feature dimension for RNN tensors) across non-feature dimensions.</p>
<p>The layer normalization primitive is optimized for the following memory formats:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Logical tensor  </th><th class="markdownTableHeadLeft">Imp   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">NC  </td><td class="markdownTableBodyLeft"><a class="el" href="group__dnnl__api__memory.html#gga395e42b594683adb25ed2d842bb3091dac08a541001fe70289305a5fbde48906d" title="2D CNN activations tensor, an alias to dnnl_ab ">dnnl_nc</a> (<a class="el" href="group__dnnl__api__memory.html#gga395e42b594683adb25ed2d842bb3091da1bd907fc29344dfe7ba88336960dcf53" title="plain 2D tensor ">dnnl_ab</a>)   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">TNC  </td><td class="markdownTableBodyLeft"><a class="el" href="group__dnnl__api__memory.html#gga395e42b594683adb25ed2d842bb3091da2a9735ec024c9362b717304edbfe2237" title="3D RNN data tensor in the format (seq_length, batch, input channels), an alias to dnnl_abc...">dnnl_tnc</a> (<a class="el" href="group__dnnl__api__memory.html#gga395e42b594683adb25ed2d842bb3091dadff5ea69392d7e4da23179dc0ba7cbc2" title="plain 3D tensor ">dnnl_abc</a>), <a class="el" href="group__dnnl__api__memory.html#gga395e42b594683adb25ed2d842bb3091da5d73ca7a68559ef44241be5a096e6bff" title="3D RNN data tensor in the format (batch, seq_length, input channels), an alias to dnnl_bac...">dnnl_ntc</a> (<a class="el" href="group__dnnl__api__memory.html#gga395e42b594683adb25ed2d842bb3091dae31cc3d3a0bfbd4936f7b503cf6dc9de" title="permuted 3D tensor ">dnnl_bac</a>)   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">LDNC  </td><td class="markdownTableBodyLeft"><a class="el" href="group__dnnl__api__memory.html#gga395e42b594683adb25ed2d842bb3091da4fd1cf9fdb67c554bcd8281695b65b3c" title="4D RNN states tensor in the format (num_layers, num_directions, batch, state channels), an alias to dnnl_abcd. ">dnnl_ldnc</a> (<a class="el" href="group__dnnl__api__memory.html#gga395e42b594683adb25ed2d842bb3091da6e669cc61278663a5ddbd3d0b25c6c5c" title="plain 4D tensor ">dnnl_abcd</a>)   </td></tr>
</table>
<h2>Performance Tips</h2>
<ol type="1">
<li>For data tensors (<code>src</code>, <code>dst</code>, <code>diff_src</code>, <code>diff_dst</code>), use memory formats for which the last logical axis is the last in the physical memory layout.</li>
<li>For <code>mean</code>/<code>variance</code>, use the memory format that follows the data memory format; i.e., if the data format is <a class="el" href="group__dnnl__api__memory.html#gga395e42b594683adb25ed2d842bb3091da2a9735ec024c9362b717304edbfe2237" title="3D RNN data tensor in the format (seq_length, batch, input channels), an alias to dnnl_abc...">dnnl_tnc</a>, the best performance can be expected for statistics with <a class="el" href="group__dnnl__api__memory.html#gga395e42b594683adb25ed2d842bb3091dac1ee747f881fc8cae805ae4051e671cf" title="2D RNN statistics tensor, an alias to dnnl_ab ">dnnl_tn</a> and suboptimal for statistics with the <a class="el" href="group__dnnl__api__memory.html#gga395e42b594683adb25ed2d842bb3091da7ede27a46172c1ab2775593ba4b118dc" title="2D RNN statistics tensor, an alias to dnnl_ba ">dnnl_nt</a> format.</li>
<li>For backward propagation, use the same memory format for <code>src</code>, <code>diff_dst</code>, and <code>diff_src</code> (the format of <code>diff_dst</code> and <code>diff_src</code> are always the same because of the API). Different formats are functionally supported but lead to highly suboptimal performance.</li>
<li>Use in-place operations whenever possible (see caveats in General Notes).</li>
</ol>
<h2>Examples</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Engine  </th><th class="markdownTableHeadLeft">Name  </th><th class="markdownTableHeadLeft">Com   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">CPU/GPU  </td><td class="markdownTableBodyLeft"><a class="el" href="layer_normalization_example_cpp.html">Layer Normalization Primitive Example</a>  </td><td class="markdownTableBodyLeft"><p class="starttd">This C++ API example demonstrates how to create and execute a <a class="el" href="dev_guide_layer_normalization.html">Layer normalization</a> primitive in forward propagation mode.</p>
<p class="endtd">Key optimizations included in this example:</p><ul>
<li>In-place primitive execution;</li>
<li>Creation of memory objects using the primitive descriptor.   </li>
</ul>
</td></tr>
</table>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div class="footer">
    <script>
        $('#top').prependTo($('#side-nav'));
    </script>
    <div class="footer-wrapper">
        <hr>
        <ul class="footer-links">
            <li><a href="legal_information.html">Legal information</a></li>
        </ul>
    </div>
</div>