<!-- HTML header for doxygen 1.8.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>DNNL: Basic Concepts</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script src="assets/mathjax/MathJax.js?config=TeX-AMS_CHTML"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
<link href="assets/customdoxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="assets/dnn.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
   <div id="projectname">Deep Neural Network Library (DNNL)
   &#160;<span id="projectnumber">1.1.3</span>
   </div>
   <div id="projectbrief">Performance library for Deep Learning</div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Basic Concepts </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h3>Primitives</h3>
<p>DNNL is built around the notion of a <em>primitive</em> (<a class="el" href="classdnnl_1_1primitive.html">dnnl::primitive</a>), a functor object that encapsulates a particular computation such as forward convolution, backward LSTM computations, or a data movement operation that changes the way data is laid out in memory. A single primitive can sometimes represent more complex, <em>fused</em>, computations such as a forward convolution followed by a ReLU.</p>
<p>The most basic difference between a <em>primitive</em> and a <em>function</em> is that a <em>primitive</em> can store <b>state</b>. For example, a convolution primitive stores operation parameters like tensor shapes and can pre-compute other secondary parameters like cache blocking. This also allows pre-generating code specifically tailored for the operation to be performed. The time it takes to perform the pre-computations can be amortized by reusing the same primitive to perform computations multiple times.</p>
<p>In addition to encapsulating the state, a primitive can also use a <em>scratchpad</em>, a temporary memory buffer, that it uses during computations. The scratchpad can be either tied to a particular primitive object (which makes that object non-thread safe), or provided as one of the parameters during execution.</p>
<h3>Engines</h3>
<p><em>Engine</em> (<a class="el" href="structdnnl_1_1engine.html">dnnl::engine</a>) is an abstraction of a particular computational device. Currently, the only supported engine is CPU. Most primitives are created to perform computations on a particular engine. The only exception is reorder primitive, which can be used to transfer data between different engines.</p>
<h3>Streams</h3>
<p><em>Streams</em> (<a class="el" href="structdnnl_1_1stream.html">dnnl::stream</a>) encapsulate execution context tied to a particular engine.</p>
<h3>Memory Objects</h3>
<p><em>Memory objects</em> (<a class="el" href="structdnnl_1_1memory.html">dnnl::memory</a>) encapsulate engine-specific memory handles, tensor dimensions, data type, and memory format &ndash; the way tensor data is laid out. (Side note: Formally, primitives should also be referred to as <em>primitive objects</em>, but because the word 'primitive' is less overloaded than 'memory', we can omit the 'object' part without causing confusion.)</p>
<p>Memory objects are passed to primitives during execution via a special map that defines which tensor (source, destination or weights, or their gradients) each memory object represents.</p>
<h2>Levels of Abstraction</h2>
<p>DNNL has multiple levels of abstractions for primitives and memory objects in order to expose maximum flexibility to its users.</p>
<p>On the <em>logical</em> level, the library provides the following abstractions:</p>
<ul>
<li><em>Memory descriptor</em> (<a class="el" href="structdnnl_1_1memory_1_1desc.html">dnnl::memory::desc</a>) provides a way to describe a tensor's logical dimensions, data type, and, potentially, the format in which the data is laid out in memory. A memory descriptor can be created with a placeholder format tag (<a class="el" href="structdnnl_1_1memory.html#a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fa100b8cad7cf2a56f6df78f171f97a1ec">dnnl::memory::format_tag::any</a>), which is used to indicate that the actual format will be defined later (see <a class="el" href="memory_format_propagation_cpp.html">Memory format propagation</a>).</li>
<li><em>Operation descriptors</em> (one for each supported primitive) serve a purpose similar to the memory descriptor: they provide a way to describe an operation's most basic properties without specifying, for example, which engine will be used to compute them.</li>
<li><em>Primitive descriptors</em> (<a class="el" href="group__c__api__primitive__descs.html#gaabde3e27edf071b62b39f47bace7efd6">dnnl_primitive_desc_t</a>; in the C++ API there are multiple types for each supported primitive) are at an abstraction level in between operation descriptors and primitives and can be used to inspect details of a particular primitive implementation like expected memory formats via <em>queries</em> without having to fully instantiate a primitive. The primitive descriptors are crucial to implement memory format propagation.</li>
</ul>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Abstraction level  </th><th class="markdownTableHeadNone">Memory object  </th><th class="markdownTableHeadNone">Primitive objects   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Logical description  </td><td class="markdownTableBodyNone">Memory descriptor  </td><td class="markdownTableBodyNone">Operation descriptor   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">Intermediate description  </td><td class="markdownTableBodyNone">N/A  </td><td class="markdownTableBodyNone">Primitive descriptor   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Implementation  </td><td class="markdownTableBodyNone">Memory object  </td><td class="markdownTableBodyNone">Primitive   </td></tr>
</table>
<h2>Creating Memory Objects and Primitives</h2>
<h3>Memory Objects</h3>
<p>Memory objects are created from the memory descriptors. It is not possible to create a memory object from a memory descriptor that has memory format set to <a class="el" href="structdnnl_1_1memory.html#a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fa100b8cad7cf2a56f6df78f171f97a1ec" title="Placeholder memory format tag. ">dnnl::memory::format_tag::any</a>.</p>
<p>There are two common ways for initializing memory descriptors:</p>
<ul>
<li>By using <a class="el" href="structdnnl_1_1memory_1_1desc.html">dnnl::memory::desc</a> constructors or by extracting a descriptor for a part of a tensor via <a class="el" href="structdnnl_1_1memory_1_1desc.html#ab369a09dee3b0eb879e0e1cbccdfe7d7">dnnl::memory::desc::submemory_desc</a></li>
<li>By <em>querying</em> an existing primitive descriptor for a memory descriptor corresponding to one of the primitive's parameters (for example, <a class="el" href="structdnnl_1_1convolution__forward_1_1primitive__desc.html#a585a3809a4f28938e53f901ed103da24">dnnl::convolution_forward::primitive_desc::src_desc</a>).</li>
</ul>
<p>Memory objects can be created with a user-provided handle (a <code>void *</code> on CPU), or without one, in which case the library will allocate storage space on its own.</p>
<h3>Primitives</h3>
<p>The sequence of actions to create a primitive is:</p>
<ol type="1">
<li>Create an operation descriptor via, for example, <a class="el" href="structdnnl_1_1convolution__forward_1_1desc.html">dnnl::convolution_forward::desc</a>. The operation descriptor can contain memory descriptors with placeholder <a class="el" href="structdnnl_1_1memory.html#a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fa100b8cad7cf2a56f6df78f171f97a1ec">format_tag::any</a> memory formats if the primitive supports it.</li>
<li>Create a primitive descriptor based on the operation descriptor and an engine handle.</li>
<li>Create a primitive based on the primitive descriptor obtained in step 2. </li>
</ol>
</div></div><!-- contents -->
<div class="footer">
    <div class="footer-wrapper">
        <ul id="footer-links">
            <li><a href="legal_information.html">Legal information</a></li>
        </ul>
    </div>
</div>