<!-- HTML header for doxygen 1.8.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>oneDNN: Basic Concepts</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script src="assets/mathjax/MathJax.js?config=TeX-AMS_CHTML,dnnl"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="assets/customdoxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="assets/dnn.js"></script>
</head>
<body>
<div class="mobile-nav"><i id="nav-btn"></i><a href="index.html">oneAPI Deep Neural Network Library (oneDNN)</a></div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
   <div id="projectname">
     <a href="index.html">
      <div id="full-name">oneAPI Deep Neural Network Library (oneDNN)</div>
    </a>
   </div>
   <div id="projectbrief">Performance library for Deep Learning</div>
   <div id="projectnumber">2.2.4</div>
  <div>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('dev_guide_basic_concepts.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Basic Concepts </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Introduction</h2>
<p>In this page, an outline of the oneDNN programming model is presented, and the key concepts are discussed, including <em>Primitives</em>, <em>Engines</em>, <em>Streams</em>, and <em>Memory Objects</em>. In essence, the oneDNN programming model consists in executing one or several <em>primitives</em> to process data in one or several <em>memory objects</em>. The execution is performed on an <em>engine</em> in the context of a <em>stream</em>. The relationship between these entities is briefly presented in Figure 1, which also includes additional concepts relevant to the oneDNN programming model, such as primitive <em>attributes</em> and <em>descriptors</em>. These concepts are described below in much more details.</p>
<p> <style>div.image img[src="img_programming_model.png"]{width:60%;}</style><br />
</p><div class="image">
<img src="img_programming_model.png" alt="img_programming_model.png"/>
<div class="caption">
Figure 1: Overview of oneDNN programming model. Blue rectangles denote oneDNN objects, and red lines denote dependencies between objects.</div></div>
 <h3>Primitives</h3>
<p>oneDNN is built around the notion of a <em>primitive</em> (<a class="el" href="structdnnl_1_1primitive.html">dnnl::primitive</a>). A <em>primitive</em> is an object that encapsulates a particular computation such as forward convolution, backward LSTM computations, or a data transformation operation. Additionally, using primitive <em>attributes</em> (<a class="el" href="structdnnl_1_1primitive__attr.html">dnnl::primitive_attr</a>) certain primitives can represent more complex <em>fused</em> computations such as a forward convolution followed by a ReLU.</p>
<p>The most important difference between a primitive and a pure function is that a primitive can store state.</p>
<p>One part of the primitive’s state is immutable. For example, convolution primitives store parameters like tensor shapes and can pre-compute other dependent parameters like cache blocking. This approach allows oneDNN primitives to pre-generate code specifically tailored for the operation to be performed. The oneDNN programming model assumes that the time it takes to perform the pre-computations is amortized by reusing the same primitive to perform computations multiple times.</p>
<p>The mutable part of the primitive’s state is referred to as a scratchpad. It is a memory buffer that a primitive may use for temporary storage only during computations. The scratchpad can either be owned by a primitive object (which makes that object non-thread safe) or be an execution-time parameter.</p>
<h3>Engines</h3>
<p><em>Engines</em> (<a class="el" href="structdnnl_1_1engine.html">dnnl::engine</a>) is an abstraction of a computational device: a CPU, a specific GPU card in the system, etc. Most primitives are created to execute computations on one specific engine. The only exceptions are reorder primitives that transfer data between two different engines.</p>
<h3>Streams</h3>
<p><em>Streams</em> (<a class="el" href="structdnnl_1_1stream.html">dnnl::stream</a>) encapsulate execution context tied to a particular engine. For example, they can correspond to OpenCL command queues.</p>
<h3>Memory Objects</h3>
<p><em>Memory objects</em> (<a class="el" href="structdnnl_1_1memory.html">dnnl::memory</a>) encapsulate handles to memory allocated on a specific engine, tensor dimensions, data type, and memory format – the way tensor indices map to offsets in linear memory space. Memory objects are passed to primitives during execution.</p>
<h2>Levels of Abstraction</h2>
<p>oneDNN has multiple levels of abstractions for primitives and memory objects in order to expose maximum flexibility to its users.</p>
<p>On the <em>logical</em> level, the library provides the following abstractions:</p>
<ul>
<li><em>Memory descriptors</em> (<a class="el" href="structdnnl_1_1memory_1_1desc.html">dnnl::memory::desc</a>) define a tensor's logical dimensions, data type, and the format in which the data is laid out in memory. The special format <em>any</em> (<a class="el" href="structdnnl_1_1memory.html#a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fa100b8cad7cf2a56f6df78f171f97a1ec">dnnl::memory::format_tag::any</a>) indicates that the actual format will be defined later (see <a class="el" href="memory_format_propagation_cpp.html">Memory Format Propagation</a>).</li>
<li><em>Operation descriptors</em> (one for each supported primitive) describe an operation's most basic properties without specifying, for example, which engine will be used to compute them. For example, convolution descriptor describes shapes of source, destination, and weights tensors, propagation kind (forward, backward with respect to data or weights), and other implementation-independent parameters.</li>
<li><em>Primitive descriptors</em> (<a class="el" href="group__dnnl__api__primitives__common.html#gaabde3e27edf071b62b39f47bace7efd6">dnnl_primitive_desc_t</a>; in the C++ API there are multiple types for each supported primitive) are at an abstraction level in between operation descriptors and primitives and can be used to inspect details of a specific primitive implementation like expected memory formats via queries to implement memory format propagation (see <a class="el" href="memory_format_propagation_cpp.html">Memory Format Propagation</a>) without having to fully instantiate a primitive.</li>
</ul>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Abstraction level  </th><th class="markdownTableHeadNone">Memory object  </th><th class="markdownTableHeadNone">Primitive objects   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Logical description  </td><td class="markdownTableBodyNone">Memory descriptor  </td><td class="markdownTableBodyNone">Operation descriptor   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">Intermediate description  </td><td class="markdownTableBodyNone">N/A  </td><td class="markdownTableBodyNone">Primitive descriptor   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Implementation  </td><td class="markdownTableBodyNone">Memory object  </td><td class="markdownTableBodyNone">Primitive   </td></tr>
</table>
<h2>Creating Memory Objects and Primitives</h2>
<h3>Memory Objects</h3>
<p>Memory objects are created from the memory descriptors. It is not possible to create a memory object from a memory descriptor that has memory format set to <a class="el" href="structdnnl_1_1memory.html#a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fa100b8cad7cf2a56f6df78f171f97a1ec" title="Placeholder memory format tag. ">dnnl::memory::format_tag::any</a>.</p>
<p>There are two common ways for initializing memory descriptors:</p>
<ul>
<li>By using <a class="el" href="structdnnl_1_1memory_1_1desc.html">dnnl::memory::desc</a> constructors or by extracting a descriptor for a part of a tensor via <a class="el" href="structdnnl_1_1memory_1_1desc.html#a7de2abef3b34e94c5dfa16e1fc3f3aab">dnnl::memory::desc::submemory_desc</a></li>
<li>By <em>querying</em> an existing primitive descriptor for a memory descriptor corresponding to one of the primitive's parameters (for example, <a class="el" href="structdnnl_1_1convolution__forward_1_1primitive__desc.html#a585a3809a4f28938e53f901ed103da24">dnnl::convolution_forward::primitive_desc::src_desc</a>).</li>
</ul>
<p>Memory objects can be created with a user-provided handle (a <code>void *</code> on CPU), or without one, in which case the library will allocate storage space on its own.</p>
<h3>Primitives</h3>
<p>The sequence of actions to create a primitive is:</p>
<ol type="1">
<li>Create an operation descriptor via, for example, <a class="el" href="structdnnl_1_1convolution__forward_1_1desc.html">dnnl::convolution_forward::desc</a>. The operation descriptor can contain memory descriptors with placeholder <a class="el" href="structdnnl_1_1memory.html#a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fa100b8cad7cf2a56f6df78f171f97a1ec">format_tag::any</a> memory formats if the primitive supports it.</li>
<li>Create a primitive descriptor based on the operation descriptor, engine and attributes.</li>
<li>Create a primitive based on the primitive descriptor obtained in step 2.</li>
</ol>
<dl class="section note"><dt>Note</dt><dd>The above sequence does not relate to all primitives in its entirety. For instance, the reorder primitive does not have an operation descriptor. </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div class="footer">
    <script>
        $('#top').prependTo($('#side-nav'));
    </script>
    <div class="footer-wrapper">
        <hr>
        <ul class="footer-links">
            <li><a href="legal_information.html">Legal information</a></li>
        </ul>
    </div>
</div>